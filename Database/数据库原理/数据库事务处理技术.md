
# 并发控制

## WHY

* 丢失修改

* 不能重复读

* 脏读

## 事务调度及可串行性

* 事务：数据库管理系统提供的控制数据操作的手段，将一系列数据库操作组合在一起作为整体进行操作和控制，确保一致性

### ACID

* 原子性：事务的一组操作不可分
* 一致性：避免出现三种典型不一致
* 隔离性：并发执行多个事务之间互相不受影响
* 持久性：保证已提交的事务影响是持久的


应用程序 -> 事务管理器 -> 事务调度器 -> 锁表

### 事务调度

对事务的执行顺序的调度

并发调度：多个事务宏观上并行，微观上交叉执行


## 并发调度正确性

当且仅当并发调度下所得的新数据库结果与串行运行这些事务所得新数据库完全一致，则调度正确。

可串行性：不管数据库初始状态如何，一个调度对数据库状态的影响都和某个串行调度相同。

冲突：调度中一对连续的动作，若他们顺序交换，则涉及事务中至少有一个事务的行为会改变

* 同一事务中任何两个操作都是冲突的
* 不同事务对同一元素的两个写操作是冲突的
* 不同事务对同一元素一读一写操作是冲突的

冲突可串行性：一个调度通过交换相邻两个无冲突的操作能够转换到某个串行调度

满足冲突可串行性，一定满足可串行性，反之不然

### 冲突可串行性判别算法

## 基于封锁的并发控制方法

锁是控制并发的一种手段（事务调度器）（邻接资源互斥访问 pv）


### 锁的类型

* 排它锁 X（eXclusive locks)：只有一个事务能读写，其他不行

* 共享锁 S（Shared locks):所有事务可以读，但不能写

### 相容性矩阵


### 封锁的粒度

### 两段封锁协议

两阶段：加锁段、解锁段，加锁段中不能有解锁操作，解锁段中不能有加锁操作

保证冲突可串行性


可能产生死锁协议



## 基于时间戳的并发控制方法

## 基于有效性确认的并发控制方法

# 故障恢复