# 概念

只有主机才有的层次

1. 提供进程与进程之间的逻辑通信（网络：主机-主机）
2. 复用和分用
    复用：应用层所有的应用进程都可以通过传输层在传输给网络层
    分用：传输层从网络层收到数据后交付指明的应用进程
3. 差错检测

端口号只有本地意义 长度 16bit 表示65535个不同的端口号

FTP 21 发现
telent 23 谈恋爱
SMTP 25 删好友
DNS 53 打电话
HTTP 80 还要再见

套接字Socket = (IP, 端口号)

# UDP
在IP数据服务上增加复用分用和差错检测功能

不可靠，无连接，时延小，适用于小文件，首部小
1. 无连接
2. 不可靠
3. 面向报文，应用层给多长的报文，UDP发送多长的报文，即一次发送一个完整报文
4. 无拥塞控制，适合实时应用

## UDP 首部格式

首部 8B 
源端口号 + 目的端口号 + UDP长度+UDP检验和

## UDP 校验

伪首部只有在计算检验和时出现，不向下传送也不向上递交

# TCP

1. 面向连接（虚连接）
2. 点对点
3. 可靠有序，不丢不重
4. 全双工，发送缓存，接收缓存

## TCP 报文段首部格式

首部 + 数据部分

源端口 + 目的端口 = 4B
序号 = 报文中第一个字节（TCP 面向字节）
确认号——期望收到对方下一个报文段的第一个数据字节的序号

数据偏移：数据起始处距离TCP报文段的起始处有多远（首部距离）

urg 紧急位
ack 确认位
syn 连接请求
fin 终止位

窗口字段 允许对方发送的数据量

检验和：检验首部和数据，加上伪首部，第4个字段为6

## TCP 连接管理

#### TCP 连接建立
r1 : syn = 1 seq = x(客户)
r2: syn = 1, ACK = 1, seq = y, ack = x + 1(服务器)
r3:syn = 0, ACK = 1, seq = x + 1, ack = y + 1(客户端)

SYN 洪泛攻击

SYN cookie

#### TCP 连接释放
r1 : FIN=1 seq = u (客户端结束)
r2 : ACK=1 seq=v, ack=u+1（服务）客户到服务器方向释放——半关闭
r3:FIN = 1, ACK = 1 seq=w, ack=u+1（服务）
r4: 发送确认报文段，等待2msl关闭（客户） ack=1, seq = u+1 ack = w+1

## TCP 可靠传输

可靠：保证字节流完全一样

1.校验
2. 序号：面向字节流，序号字段为报文段第一个字节序号
3. 确认
4. 重传

TCP 缓存：报文段（链路层最大单元）

确认重传不分家，

#### 超时重传

TCP 自适应算法 动态改变重传时间 RTTs(加权平均往返时间)——等太久

冗余ACK（冗余确认）

发送方收到3个对于报文段1的冗余 ACK，重传（丢失2）——快速重传

与链路层相似

#### TCP 流量控制

让发送方慢点，让接收方来得及接收

TCP 利用**滑动窗口**机制

发送窗口大小可以动态变化

字节为单位

rwnd 发送窗口

收到0 窗口通知，启动持续计时器，持续计时器时间到期，就发送一个0窗口探测报文段

#### TCP 拥塞控制

对资源需求的总和 》 可用资源

防止过多数据注入到网路中（全局性）

拥塞控制（全局， 一对多）
流量控制（一对一）

慢开始   拥塞避免

快重传  快恢复（冗余字段）

发送窗口 = min(rwnd, cwnd)

接收窗口/拥塞窗口

传输轮次：发送一批报文段并收到它们确认的时间 RTT

两种方法


