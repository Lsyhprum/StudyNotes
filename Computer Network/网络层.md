# 概念

把分组从源端传到目的端，传输单位是数据报

路由选择与分组转发

异构网络互联

拥塞控制

# 数据交换方式

* 电路交换：独占资源

1. 通信时延小
2. 有序传输
3. 没有冲突
4. 实时性强

1. 建立连接时间长
2. 效率低
3. 灵活性差
4. 无差错控制能力

* 报文交换

1. 无需建立连接
2. 存储转发，动态分配线路
3. 线路可靠性高
4. 线路利用率高
5. 多目标服务

1. 有存储转发时延
2. 报文大小不定，要有足够存储空间

* 分组交换

1. 把大数据块分割成小数据块，相对于报文交换，存储管理容易
1. 无需建立连接
2. 存储转发，动态分配线路
3. 线路可靠性高
4. 线路利用率高

1. 存储转发时延
2. 需要额外的信息量
3. 乱序到达，需要重新排序

* 报文交换和分组交换都采用存储转发
* 数据量大，且传送时间远大于呼叫时间，选择电路交换，传输时延最小
* 报文交换分组交换利用率高于电路交换

# 传输单元名词

应用层——报文
传输层——报文段
网络层——IP数据报，分组
数据链路层——帧
物理层——比特流

# 数据报 & 虚电路

## 数据报服务（Internet)

## 虚电路服务
分组交换 + 电路交换

一条源主机到目的主机类似于电路的路径（逻辑连接）

# TCP/IP 协议

![]()

## IP 数据报

首部（固定部分20B-160bit+可变部分） + 数据部分（） = IP数据报

![IP数据报格式]()

4B 整数倍

版本 首部长度 区分服务 总长度

标识（同一数据报分片使用同一标识） 标志（中间位DF 是否允许分片 最低位MF 代表最后一片/没分片） 片偏移（在原分组的相对位置，除了最后一个分片，每个分片长度一定是8B的整数倍）

生存时间（TTL） 协议（TCP（6 很溜） UDP（17 容易遗弃）） 首部检验和

源地址(32bit)

目的地址（32bit)

可选字段 填充

总长度单位 1B
片偏移单位 8B
首部长度单位 4B

一种（总）八片(片偏移）的首（首部长度单位）饰（4）

### 最大传送单位MTU

链路层数据帧可封装数据的上限
以太网 MTU 是 1500 字节

# IP 地址

32bit 

IP地址：网络号+ 主机号

A类 1                    1-127
 /b类  16                128 -191
  /C类  256

## 特殊IP 

0.0.0 本主机
0.0.0.1 本网某个特定主机
全1 本网广播地址
特定值 全0  表示一个网络
特定值 全1 对特定网络广播
127。0.0.1 任何数  环回地址 软件测试

## 私有IP地址

A 10.0.0.0~10.255.255.255 网段个数 1
B 172.16.0.0~172.31.255.255 网段个数 16
C 192.168.0.0~192.168.255.255 网段个数 256

## NAT

网络地址转换 NAT（172.38.1.5）
全球IP地址
NAT 转换表（全村只有一台电话，打给村支书，村支书再打出去）

### 子网划分
1.IP地址空间利用率低
2.两级IP地址不够灵活

三级IP地址 主机号 = 子网号 + 主机号
									145.13  + .3.10

二级子网掩码 255.255.0.0
三级IP子网掩码 255.255.255.0

路由表中：
目的网络地址
目的网络子网掩码
下一跳地址

路由器转发分组
1.提取目的IP
2.是否直接交付
3.特定主机路由
4.检查路由表中有无路径
5.默认路由（0.0.0.0）
6.丢弃

### 无分类编制 CIDR

增加可分配主机数
变长子网掩码

1.消除传统 A,B,C类地址以及划分子网概念
IP地址后加上 / 写上网络前缀


### ARP 协议

发送数据过程，如何添加目的MAC地址

集线器？
交换机？没有目的地址

同一子网：广播ARP请求分组  单播ARP响应分组

在实际网络的链路上传送数据帧时，必须使用MAC地址

ARP：完成主机或路由器IP到MAC 地址映射，下一跳走哪

步骤：
1. 检查ARP高速缓存，有对应项写入MAC帧，没有FFFFFF，并广播ARP请求分组，目的主机收到后单播一个ARP响应分组，写入ARP缓存

情况
1. 主机A本网络B：ARP找B硬件地址
2. 主机A另一网络B：ARP找网关硬件地址
3. 路由器本网络主机A：ARP找主机A硬件地址
4. 路由器另一网络主机B：ARP找本网络的一个路由器硬件地址

网络 ？ 冲突域？广播域？

### DHCP

静态配置
动态配置

默认网关——路由器一个接口，通过默认网关与外部通信

DHCP 应用层协议 使用客户/服务器方式，客户端和服务端通过广播方式进行交互，基于UDP

支持移动用户加入网络

有没有DHCP服务器？
有
我用IP地址了？  告知其他服务器撤销
用吧

### ICMP
差错报告

ICMP 报文 ——》IP数据报 数据部分=（ICMP 前8字节 + 错误IP数据报首部）

差错报告报文种类：

1. 终点不可达
2. 源点抑制
3. 时间超过 TTL=0
4. 参数问题 首部有问题
5. 改变路由（重定向） 值得更好的路由

询问报文
1. 回送请求和回答报文  测试目的站是否可到达
2. 时间戳

PING  回送请求和回答报文
Traceroute  ICMP时间超过差错报告报文

### IPV6

IPV4 空间分配殆尽
CIDR NAT

首部固定 40字节

记忆：
1.32位扩大到128位
2.移除校验ziduan，减少处理时间
3.灵活首部格式,不对扩展首部检查，速度快
4.即插即用，不需要DHCP
5.IPV6首部 8B整数倍 ipv4 4B
6. v6主机处分片
7. ICMPv6:附加报文类型“分组过大”

表示形式
v4:点分10进制
v6:冒号16进制记法
压缩形式：/零压缩法

单播：一对一
多播：一对多
任播：最近一台

v4 v6 过度

双栈协议  同时启用v4 v6

隧道技术  重新封装（IPV6 作为 IPV4 数据部分）

IPV6 -> IPV4

## 路由算法

最佳路由：只能是相对于某一种特定要求下得出的较为好的

静态路由算法(非自适应路由算法)：管理员手工配置
动态路由算法（自适应路由算法那）：路由器间彼此交换信息，按照路由算法优化出路由表项（算法复杂，增加网络负担）

动态路由算法
全局性：OSPF（链路状态路由算法） 完整网络拓扑
分散性：RIP（距离向量路由算法） 局部

分层次路由选择协议
1. internet 很大
2. 子网

自治系统AS(小团体)：互联网分割

路由器选择协议：
内部网关协议 IGP（AS）：RIP OSPF
外部网关协议 EGP（AS 之间）：BGP

！[路由选择协议]()

##
和谁交换信息

交换什么

多久交换

### rip 协议
分布式基于距离向量的路由选择协议

维护从它自己到其他每一个目的网络的唯一最佳距离记录

RIP 最多包含15个路由器，16表示网络不可达（TTL也是16）

小互联网

1.仅和相邻路由器交换信息
2.交换信息是自己的路由表
3.30 秒交换路由信息，180秒没收到，判定邻居没了，并更新自己路由表

距离向量算法
1. 修改相邻路由器发来的RIP报文中所有表项，下一跳地址改为X，距离+1
2.无Net信息，直接填入
3、有Net信息
		1.下一跳是X，替换
		2.不是X， 比较距离
4/180s 无信息，不可达，距离设置为16

### OSPF 协议（开放最短路径优先）

和谁：所有路由器（广播）

交换什么：相邻所有路由器的链路状态（费用、距离、时延、带宽）

多久：当链路变化

最后形成全网拓扑图

1. HELLO 问候分组
2. 设置每个邻居的成本度量
3. DD 数据库描述分组
4. 若没有和更新，则发送 LSR 链路状态请求分组
5. 发送 LSU 链路状态更新分组
6. LSAck 链路状态确认分组
7. 泛洪发送 LSU链路状态更新分组
8. 更新完毕，其他站返回LSAck 链路状态确认分组
9. 使用 Dijkstra 计算最短路径

1. 每隔30min 刷新
2. 互联网规模大时使用
3. 收敛速度很快

### BGP 协议

和谁：与其他AS的邻站BGP发言人交换信息

交换什么：网络可达性

多久交换：发生变化时

TCP 连接
1. 支持CIDR
2. 交换变化部分

4中报文
1.OPEN 连接
2 UPDATE 更新
3 KEEPLIVE 保活
4. NOTIFICATION 通知，报告差错


### 比较

RIP 内部网关  广播UDP

OSPF 内部网关  直接使用ip 全局

BGP 外部网关  TCP （网络复杂，保证可靠）

### IP数据报三种传输方式

单播：点对点

广播：点对多点

多播：组播分发树，点对多点，只有到达尽可能近的节点才复制和分发


### IP 组播地址

组播组IP地址 ：D类地址，只能作为目标地址，源地址为单播

1. UDP
2. 无 ICMP 差错报文
3. 并非所有 D 类

### 硬件组播

组播MAC 地址

### IGMP 协议与组播路由选择协议

网际组管理协议IGMP

## 移动 IP

### 相关术语

移动 ip 是移动结点以固定网络IP地址，实现跨越不同网段的**漫游**功能，并保证基于网络IP的网络权限在漫游过程中不发生改变。

移动结点：具有永久IP地址的移动设备

本地代理：代表移动节点执行移动管理功能的实体叫做归属代理

外部代理：在外部网络中帮助移动结点完成移动管理功能的实体

# 网络设备

* 路由器：多个输入端口和多个输出端口的专用计算器，任务是转发分组

* 路由表：目的网络IP地址 子网掩码 下一跳IP地址 接口

转发表由路由表得来

